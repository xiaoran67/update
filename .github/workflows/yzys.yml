name: ä¸‹è½½æ›´æ–°ä¼˜è´¨å¤®å«åˆ—è¡¨
on:
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 0 * * *'  # å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤© UTC 0 ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´ 8 ç‚¹ï¼‰æ‰§è¡Œ
    # å¦‚éœ€è°ƒæ•´æ—¶é—´ï¼Œå¯ä¿®æ”¹ cron è¡¨è¾¾å¼ï¼ˆæ ¼å¼ï¼šåˆ† æ—¶ æ—¥ æœˆ å‘¨ï¼ŒUTCæ—¶é—´ï¼‰
    # ä¾‹å¦‚ï¼šæ¯å¤©åŒ—äº¬æ—¶é—´ 2 ç‚¹æ‰§è¡Œ â†’ cron: '0 18 * * *'ï¼ˆUTC 18 ç‚¹ = åŒ—äº¬æ—¶é—´ 2 ç‚¹+8å°æ—¶ï¼‰

jobs:
  update-iptv:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: ä¸‹è½½ç›®æ ‡æ–‡ä»¶
        run: |
          curl -fSL "https://raw.githubusercontent.com/kakaxi-1/IPTV/refs/heads/main/ipv4.1.txt" -o "temp_ipv4.txt"
          if [ ! -f "temp_ipv4.txt" ]; then
            echo "æ–‡ä»¶ä¸‹è½½å¤±è´¥"
            exit 1
          fi

      - name: é‡å‘½åå¹¶ç§»åŠ¨æ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•
        run: |
          mkdir -p "æ‰‹å·¥åŒº"
          mv "temp_ipv4.txt" "æ‰‹å·¥åŒº/â™ªä¼˜è´¨å¤®è§†.txt"
          if [ ! -f "æ‰‹å·¥åŒº/â™ªä¼˜è´¨å¤®è§†.txt" ]; then
            echo "æ–‡ä»¶ç§»åŠ¨å¤±è´¥"
            exit 1
          fi

      - name: æäº¤å¹¶æ¨é€æ›´æ–°
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add "æ‰‹å·¥åŒº/â™ªä¼˜è´¨å¤®è§†.txt"
          if git diff --quiet --cached; then
            echo "æ–‡ä»¶æ— æ›´æ–°ï¼Œæ— éœ€æäº¤"
          else
            git commit -m "ğŸ€ï¼ˆ$(date +'%Y-%m-%d %H:%M:%S')ï¼‰"
            git push "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git" HEAD:${{ github.ref_name }}
          fi
